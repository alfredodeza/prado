---
  - name: Set SELinux to allow Nginx to proxy
    become: true
    seboolean:
      name: httpd_can_network_connect
      state: yes
      persistent: yes

  - name: ensure sites-available for nginx
    file: path=/etc/nginx/sites-available state=directory
    become: true

  - name: ensure sites-enable for nginx
    file: path=/etc/nginx/sites-enabled state=directory
    become: true

  - name: remove default nginx site
    action: file path=/etc/nginx/sites-enabled/default state=absent
    become: true

  - name: write nginx.conf
    action: template src=../templates/nginx.conf dest=/etc/nginx/nginx.conf
    become: true

  - name: enable nginx
    become: true
    action: service name=nginx enabled=true

  - name: create nginx site config
    action: template src=../templates/nginx_site.conf dest=/etc/nginx/sites-available/{{ app_name }}.conf
    become: true
    notify:
      - restart nginx

  - name: link nginx config
    action: file src=/etc/nginx/sites-available/{{ app_name }}.conf dest=/etc/nginx/sites-enabled/{{ app_name }}.conf state=link
    become: true

  - name: ensure nginx is started
    become: true
    action: service name=nginx state=started
